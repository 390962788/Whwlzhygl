<template>
  <div>
    <el-form :model="formData" :rules="rules" ref="ruleForm" label-width="200px" size="medium">
      <el-form-item label="车牌" prop="plateNum">
        <el-input v-model="formData.plateNum"></el-input>
      </el-form-item>
      <el-form-item label="地址" prop="address">
        <el-input v-model="formData.address"></el-input>
      </el-form-item>
      <el-form-item label="整备重量" prop="approveWeight">
        <el-input v-model="formData.approveWeight"></el-input>
      </el-form-item>
      <el-form-item label="品牌型号" prop="brand">
        <el-input v-model="formData.brand"></el-input>
      </el-form-item>
      <el-form-item label="行驶证图片" prop="carDrivingLicensePath">
        <el-upload
          :data="{fileType: 'CAR_RUN_LICENSE'}"
          class="small"
          :action="$baseURL + 'accessory/addAccessory'"
          :file-list="picsList1"
          :on-success="handleUpload1"
          :on-remove="handleRemove1"
          :on-preview="handlePictureCardPreview"
          list-type="picture-card">
          <i class="el-icon-plus"></i>
        </el-upload>
      </el-form-item>
      <el-form-item label="检验有效截止日期" prop="checkEndDate">
        <el-date-picker v-model="formData.checkEndDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="承运人责任险图片" prop="cliPath">
        <el-upload
          class="small"
          :action="$baseURL + 'accessory/addAccessory'"
          :file-list="picsList2"
          :on-success="handleUpload2"
          :on-remove="handleRemove2"
          :on-preview="handlePictureCardPreview"
          list-type="picture-card">
          <i class="el-icon-plus"></i>
        </el-upload>
      </el-form-item>
      <el-form-item label="承运人责任险有效期截止日期" prop="cliValidityEndDate">
        <el-date-picker v-model="formData.cliValidityEndDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="承运人责任险有效期开始日期" prop="cliValidityStartDate">
        <el-date-picker v-model="formData.cliValidityStartDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="核载重量" prop="curbWeight">
        <el-input v-model="formData.curbWeight"></el-input>
      </el-form-item>
      <el-form-item label="发动机号" prop="engineNum">
        <el-input v-model="formData.engineNum"></el-input>
      </el-form-item>
      <el-form-item label="档案编号" prop="fileNumber">
        <el-input v-model="formData.fileNumber"></el-input>
      </el-form-item>
      <el-form-item label="GPS安装证明图片" prop="gpsInstallPath">
        <el-upload
          class="small"
          :action="$baseURL + 'accessory/addAccessory'"
          :file-list="picsList3"
          :on-success="handleUpload3"
          :on-remove="handleRemove3"
          :on-preview="handlePictureCardPreview"
          list-type="picture-card">
          <i class="el-icon-plus"></i>
        </el-upload>
      </el-form-item>
      <el-form-item label="发证日期" prop="issuingDate">
        <el-date-picker v-model="formData.issuingDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="营运证图片" prop="motPath">
        <el-upload
          class="small"
          :action="$baseURL + 'accessory/addAccessory'"
          :file-list="picsList4"
          :on-success="handleUpload4"
          :on-remove="handleRemove4"
          :on-preview="handlePictureCardPreview"
          list-type="picture-card">
          <i class="el-icon-plus"></i>
        </el-upload>
      </el-form-item>
      <el-form-item label="年检有效期截止日期" prop="motValidityEndDate">
        <el-date-picker v-model="formData.motValidityEndDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="年检有效期开始日期" prop="motValidityStartDate">
        <el-date-picker v-model="formData.motValidityStartDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="所有人" prop="owner">
        <el-input v-model="formData.owner"></el-input>
      </el-form-item>
      <el-form-item label="载客人数" prop="peopleNumber">
        <el-input v-model="formData.peopleNumber"></el-input>
      </el-form-item>
      <el-form-item label="牵引重量" prop="pullWeight">
        <el-input v-model="formData.pullWeight"></el-input>
      </el-form-item>
      <el-form-item label="注册日期" prop="registerDate">
        <el-date-picker v-model="formData.registerDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="注册附件" prop="registerPath">
        <el-upload
          class="small"
          :action="$baseURL + 'accessory/addAccessory'"
          :file-list="picsList5"
          :on-success="handleUpload5"
          :on-remove="handleRemove5"
          :on-preview="handlePictureCardPreview"
          list-type="picture-card">
          <i class="el-icon-plus"></i>
        </el-upload>
      </el-form-item>
      <el-form-item label="营运证号" prop="roadTransportNum">
        <el-input v-model="formData.roadTransportNum"></el-input>
      </el-form-item>
      <el-form-item label="营运证有效期截止日期" prop="roadTransportValidityEndDate">
        <el-date-picker v-model="formData.roadTransportValidityEndDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="营运证有效期开始时间" prop="roadTransportValidityStartDate">
        <el-date-picker v-model="formData.roadTransportValidityStartDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="尺寸" prop="size">
        <el-input v-model="formData.size"></el-input>
      </el-form-item>
      <el-form-item label="罐体检测报告" prop="tankReportPath">
        <el-upload
          class="small"
          :action="$baseURL + 'accessory/addAccessory'"
          :file-list="picsList6"
          :on-success="handleUpload6"
          :on-remove="handleRemove6"
          :on-preview="handlePictureCardPreview"
          list-type="picture-card">
          <i class="el-icon-plus"></i>
        </el-upload>
      </el-form-item>
      <el-form-item label="技术等级评定" prop="technicalGrade">
        <el-input v-model="formData.technicalGrade"></el-input>
      </el-form-item>
      <el-form-item label="技术等级证书图片" prop="technicalGradePath">
        <el-upload
          class="small"
          :action="$baseURL + 'accessory/addAccessory'"
          :file-list="picsList7"
          :on-success="handleUpload7"
          :on-remove="handleRemove7"
          :on-preview="handlePictureCardPreview"
          list-type="picture-card">
          <i class="el-icon-plus"></i>
        </el-upload>
      </el-form-item>
      <el-form-item label="技术等级评定有效期截止日期" prop="technicalGradeValidityEndDate">
        <el-date-picker v-model="formData.technicalGradeValidityEndDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="技术等级评定有效期开始日期" prop="technicalGradeValidityStartDate">
        <el-date-picker v-model="formData.technicalGradeValidityStartDate" type="datetime" value-format="yyyy-MM-dd HH:mm"></el-date-picker>
      </el-form-item>
      <el-form-item label="总重量" prop="totalWeight">
        <el-input v-model="formData.totalWeight"></el-input>
      </el-form-item>
      <el-form-item label="类型" prop="type">
        <el-input v-model="formData.type"></el-input>
      </el-form-item>
      <el-form-item label="使用性质" prop="useProperty">
        <el-input v-model="formData.useProperty"></el-input>
      </el-form-item>
      <el-form-item label="车架号" prop="vin">
        <el-input v-model="formData.vin"></el-input>
      </el-form-item>
      <el-dialog :visible.sync="dialogVisible" append-to-body>
        <img width="100%" :src="dialogImageUrl" alt="">
      </el-dialog>
      <el-form-item>
        <el-button type="primary" @click="submitForm('ruleForm')" :loading="posting">保存</el-button>
        <el-button @click="resetForm('ruleForm')">重置</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>
<script>
import uploadMixin from '@/mixins/upload'
import saveMixin from '@/mixins/saveform'
export default {
  mixins: [uploadMixin, saveMixin],
  data() {
    return {
      formData: {
        carTeamId: this.sid,
        plateNum: '',
        address: '',
        approveWeight: '',
        brand: '',
        carDrivingLicensePath: '',
        checkEndDate: '',
        cliPath: '',
        cliValidityEndDate: '',
        cliValidityStartDate: '',
        curbWeight: '',
        engineNum: '',
        fileNumber: '',
        gpsInstallPath: '',
        issuingDate: '',
        motPath: '',
        motValidityEndDate: '',
        motValidityStartDate: '',
        owner: '',
        peopleNumber: '',
        pullWeight: '',
        registerDate: '',
        registerPath: '',
        roadTransportNum: '',
        roadTransportValidityEndDate: '',
        roadTransportValidityStartDate: '',
        size: '',
        tankReportPath: '',
        technicalGrade: '',
        technicalGradePath: '',
        technicalGradeValidityEndDate: '',
        technicalGradeValidityStartDate: '',
        totalWeight: '',
        type: '',
        useProperty: '',
        vin: ''
      },
      rules: {},
      apiName: 'car/',
      addApi: 'addCar',
      updateApi: 'updateCar',
      picsList1: [],
      picsList2: [],
      picsList3: [],
      picsList4: [],
      picsList5: [],
      picsList6: [],
      picsList7: []
    }
  },
  props: {
    id: {
      type: Number
    },
    sid: {
      type: Number
    }
  },
  mounted() {
    this.id && this.getDetail()
  },
  methods: {
    handleRemove1(file, list) {
      this.picsList1 = list
    },
    handleUpload1(res) {
      if (res.code == 0) {
        this.picsList1.push({name: res.data.accessoryName, url: this.$baseURL + res.data.accessoryName})
      }
    },
    handleRemove2(file, list) {
      this.picsList2 = list
    },
    handleUpload2(res) {
      if (res.code == 0) {
        this.picsList2.push({name: res.data.accessoryName, url: this.$baseURL + res.data.accessoryName})
      }
    },
    handleRemove3(file, list) {
      this.picsList3 = list
    },
    handleUpload3(res) {
      if (res.code == 0) {
        this.picsList3.push({name: res.data.accessoryName, url: this.$baseURL + res.data.accessoryName})
      }
    },
    handleRemove4(file, list) {
      this.picsList4 = list
    },
    handleUpload4(res) {
      if (res.code == 0) {
        this.picsList4.push({name: res.data.accessoryName, url: this.$baseURL + res.data.accessoryName})
      }
    },
    handleRemove5(file, list) {
      this.picsList5 = list
    },
    handleUpload5(res) {
      if (res.code == 0) {
        this.picsList5.push({name: res.data.accessoryName, url: this.$baseURL + res.data.accessoryName})
      }
    },
    handleRemove6(file, list) {
      this.picsList6 = list
    },
    handleUpload6(res) {
      if (res.code == 0) {
        this.picsList6.push({name: res.data.accessoryName, url: this.$baseURL + res.data.accessoryName})
      }
    },
    handleRemove7(file, list) {
      this.picsList7 = list
    },
    handleUpload7(res) {
      if (res.code == 0) {
        this.picsList7.push({name: res.data.accessoryName, url: this.$baseURL + res.data.accessoryName})
      }
    },
    async getDetail() {
      let {data} = await this.$http({
        url: 'car/getCar',
        params: {
          carId: this.id
        }
      })
      if (data.code == 0) {
        this.formData = data.data
        this.formData.id = this.id
        this.formData.carTeamId = this.sid
        this.picsList1 = this.pushPicInitList(this.formData.carDrivingLicensePath)
        this.picsList2 = this.pushPicInitList(this.formData.cliPath)
        this.picsList3 = this.pushPicInitList(this.formData.gpsInstallPath)
        this.picsList4 = this.pushPicInitList(this.formData.motPath)
        this.picsList5 = this.pushPicInitList(this.formData.registerPath)
        this.picsList6 = this.pushPicInitList(this.formData.tankReportPath)
        this.picsList7 = this.pushPicInitList(this.formData.technicalGradePath)
      }
    },
    beforePost() {
      this.formData.carDrivingLicensePath = this.joinPicIntoString(this.picsList1)
      this.formData.cliPath = this.joinPicIntoString(this.picsList2)
      this.formData.gpsInstallPath = this.joinPicIntoString(this.picsList3)
      this.formData.motPath = this.joinPicIntoString(this.picsList4)
      this.formData.registerPath = this.joinPicIntoString(this.picsList5)
      this.formData.tankReportPath = this.joinPicIntoString(this.picsList6)
      this.formData.technicalGradePath = this.joinPicIntoString(this.picsList7)
    }
  }
}
</script>